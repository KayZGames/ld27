import "dart:typed_data" as dD;import "dart:web_audio" as FC;import "dart:math" as hB;import "dart:async" as IB;import "dart:mirrors" as TG;import "dart:json" as SG;import "dart:html" as gB;class UG{static const  VG="Chrome";static const  WG="Firefox";static const  XG="Internet Explorer";static const  YG="Safari";final  YF;final  minimumVersion;const UG(this.YF,[this.minimumVersion]);}class ZG{const ZG();}class aG{final  name;const aG(this.name);}class bG{const bG();}class cG{const cG();} main(){gB.window.setImmediate((){var g=gB.query('canvas');g.width=dB;g.height=eB;IB.Future.wait([oD('../assets/img/assets'),FF('../assets/img/assets')]).then((i){var h=new jE(g,new dC(i[0]),i[1]);h.qF();gB.window.requestAnimationFrame(h.rF);});});}class jE{var canvas;var sheet;var mB;var VB;var OD=0;var m=new GC();jE(this.canvas,this.sheet,this.mB){VB=HF();} qF(){mB.forEach((g,o){var k=sheet.MD('${g}.png').pB['${g}.png'].offset;o.forEach((i){i.kB=i.kB.map((u)=>u+k).toList();});});var h=new jD();m.hC(h);m.hC(new bC());var q=LB(m,[new DB.FH(dB/2.0,eB-100.0,0.0),new JC(0.0,0.0),new vB('ship_0')]);LB(m,[new DB.FH(dB/2.0,eB-170.0,0.0),new JC(0.0,0.0),new DD(1,500.0)],player:gC);h.register(q,gC);m.HB(new fG(canvas));m.HB(new mG());m.HB(new jG(mB));m.HB(new sG());m.HB(new qG());m.HB(new oG());m.HB(new iG());m.HB(new lG());m.HB(new nG());m.HB(new pG());m.HB(new kG());m.HB(new rG());m.HB(new vD());m.HB(new uD());m.HB(new gG(LH,MH,sheet,VB));m.HB(new nD(VB));m.HB(new pD(canvas.context2D,sheet));m.HB(new eG(canvas.context2D,sheet));m.HB(new eC(canvas.context2D));m.initialize();} LH()=>CF().then(HG); MH( g)=>oD('../assets/img/assetsv${g}'); rF( g){m.aB=16.66;OD=g;m.process();gB.window.requestAnimationFrame(update);} update( g){m.aB=g-OD;OD=g;m.process();gB.window.requestAnimationFrame(update);} HG( g){var h=m.BC(eC);h.ID=g;}}class VC{static final  lE=gB.window.navigator.userAgent.contains(r'Android|webOS|iPhone|iPad|iPod|BlackBerry|Windows Phone');static  oE( g){var h=new gB.CanvasElement(width:g.width,height:g.height);h.context2D.drawImage(g,0,0);return h;}static  eD( g){var u=0,o=0,KB=0,q=0,k=0,i=0;var h=g.currentTarget;do{u+= h.offset.left;o+= h.offset.top;}while(null!=(h=h.offsetParent));if(null!=g.page.x||null!=g.page.y){k=g.page.x;i=g.page.y;}else if(g is gB.MouseEvent){if(null!=g.client.x||null!=g.client.y){k=g.client.x+gB.document.body.scrollLeft+gB.document.documentElement.scrollLeft;i=g.client.y+gB.document.body.scrollTop+gB.document.documentElement.scrollTop;}}KB=k-u;q=i-o;return new gB.Point(KB,q);}}class kE{final  FE;kE.zG(this.FE); get NH=>FE.canvas; OH( g)=>VC.eD(g); get PH=>VC.lE; get onMouseMove{var g;if(PH){g=NH.onTouchMove;}else{g=NH.onMouseMove;}return g.map((h)=>OH(h));}} mE([var g, i]){var h;if(null==g||g is int){var k=(g!=null?g:gB.window.innerWidth);i=(i!=null?i:gB.window.innerHeight);h=new gB.CanvasElement(width:k,height:i);}else if(g is String){h=gB.query(g);}else if(g is gB.ImageElement){h=VC.oE(g);}else if(g is WC){return g;}else{h=g;}return new WC(h);}class WC implements gB.CanvasRenderingContext2D{static final  nE=new RegExp((r'\s+'));var NH;var QH;var RH; get canvas=>NH; get context2d=>QH;WC(this.NH){QH=NH.context2D;RH=new kE.zG(this);} noSuchMethod( g)=>TG.reflect(QH).delegate(g); JG({ strokeStyle, fillStyle}){if(null!=strokeStyle){var g=QH.strokeStyle;QH..strokeStyle=strokeStyle..stroke()..strokeStyle=g;}if(null!=fillStyle){var g=QH.fillStyle;QH..fillStyle=fillStyle..fill()..fillStyle=g;}} fF( q, k, g, h){var i=new gB.CanvasElement(width:g,height:h);var o=i.context2D;o.drawImageScaledFromSource(NH,q,k,g,h,0,0,g,h);NH.width=g;NH.height=h;clear();QH.drawImage(i,0,0);} trim({ color}){var q;var KB;var u;if(color!=null){KB=new dG.AH(color).LG();q=KB[4]==255?true:false;}else q=true;var UB=QH.getImageData(0,0,NH.width,NH.height);var i=UB.data;var g=[NH.width,NH.height,0,0];for(var h=0,WB=i.length;h<WB;h+= 4){if(q){if(i[h+3]==0)continue;}else if(i[h+0]==color[0]&&i[h+1]==color[1]&&i[h+2]==color[2])continue;var k=(h~/4)%NH.width;var o=(h~/4)~/NH.width;if(k<g[0])g[0]=k;if(k>g[2])g[2]=k;if(o<g[1])g[1]=o;if(o>g[3])g[3]=o;}if(g[2]==0||g[3]==0){}else{u=new gB.Rect(g[0],g[1],g[2]-g[0],g[3]-g[1]);fF(g[0],g[1],g[2]-g[0]+1,g[3]-g[1]+1);}return u;} clear({ color}){if(null!=color){QH.fillStyle=color;QH.fillRect(0,0,NH.width,NH.height);}else{QH.clearRect(0,0,NH.width,NH.height);}} FG( h, g, k, o, i,{ strokeStyle, fillStyle}){QH..beginPath()..moveTo(h+i,g)..lineTo(h+k-i,g)..quadraticCurveTo(h+k,g,h+k,g+i)..lineTo(h+k,g+o-i)..quadraticCurveTo(h+k,g+o,h+k-i,g+o)..lineTo(h+i,g+o)..quadraticCurveTo(h,g+o,h,g+o-i)..lineTo(h,g+i)..quadraticCurveTo(h,g,h+i,g)..closePath();JG(strokeStyle:strokeStyle,fillStyle:fillStyle);} iE( UB, h, q, u,{ nlCallback}){var WB=new RegExp(r"(\d+)");var KB=int.parse(WB.firstMatch(font).group(0))*2;var i=ME(UB,u);for(var g=0;g<i.length;g++ ){var k=(q+g*KB*0.6).toInt();if(null!=nlCallback){nlCallback(h,k);}var o=i[g];QH.fillText(o,h,k);}} eE( h,[ g]){var k=new RegExp(r"(\d+)");var i=int.parse(k.firstMatch(font).group(0))*2;var o=ME(h,g);if(null==g){g=QH.measureText(h).width;}return new gB.Rect(0,0,g,(o.length*i*0.6).toInt());} ME( KB,[ i]){var u=KB.split(nE);var k=0;var UC=0;var g=new List<String>.from([""]);var WB=QH.measureText(" ").width;if(null!=i){i+= WB;var o=0;for(var h=0;h<u.length;h++ ){var UB="${u[h]} ";var q=QH.measureText(UB).width;if(k+q>i){g.add("");o++ ;k=0;}g[o]="${g[o]}${UB}";k+= q;}}else{g=[KB];}return g;}}typedef  pE( x, y);class dG{var r,AC,b,a;dG.AH( h,[this.a=255]){var g=qE(h);r=g[0];AC=g[1];b=g[2];} LG()=>[r,AC,b,a];} qE( g){return [int.parse('0x${g[1]}${g[2]}'),int.parse('0x${g[3]}${g[4]}'),int.parse('0x${g[5]}${g[6]}')];}class rE{static var gD=0;static var YC;static  tE( h){if(null==YC){YC=new Map<Type,int>();}var g=YC[h];if(g==null){g=1<<gD;gD++ ;YC[h]=g;}return g;}}class yC extends bB{var TH;var XH;yC():TH=new t<t<v>>(),XH=new t<l>(); initialize(){} pH( g){tH(g,(h,i){h[g.id].sH();h[g.id]=null;});g.yH=0;} DI( i, k, o){var h=k.id;TH.JI(h);var g=TH[h];if(g==null){g=new t<v>();TH[h]=g;}g[i.id]=o;i.OI(k.lC);} QI( g, h){if((g.yH&h.lC)!=0){var i=h.id;TH[i][g.id].sH();TH[i][g.id]=null;g.SI(h.lC);}} lF( i){var h=i.id;TH.JI(h);var g=TH[h];if(g==null){g=new t<v>();TH[h]=g;}return g;} tH( i, k( components, index)){var g=i.yH;var h=0;while (g>0){if((g&1)==1){k(TH[h],h);}h++ ;g=g>>1;}} nB( g)=>XH.add(g); cF(){XH.forEach((g)=>pH(g));XH.clear();}}class rB{static var AD=1;static var sE=0;var WH=0;var YH=0;rB(){WH=AD;AD=AD<<1;YH=sE++ ;} get lC=>WH; get id=>YH;}abstract class fD{ iC( g); KD( g); nB( g); enabled( g); disabled( g);}class XC{static var hD=new Map<Type,rB>();static  ZC( h){var g=hD[h];if(g==null){g=new rB();hD[h]=g;}return g;}static  uE( g)=>ZC(g).lC;}class zC extends bB{var SH;var UH;var aH;var bH=0;var cH=0;var dH=0;var XH=0;var kH;zC():SH=new t<l>(),UH=new t<l>(),aH=new t<bool>(),kH=new zE(); initialize(){} GI(){var g=UH.removeLast();if(null==g){g=new l.CH(VH,kH.bF());}dH++ ;return g;} iC( g){bH++ ;cH++ ;SH[g.id]=g;} enabled( g){aH[g.id]=false;} disabled( g){aH[g.id]=true;} nB( g){SH[g.id]=null;aH[g.id]=false;UH.add(g);bH-- ;XH++ ;} isActive( g)=>SH[g]!=null; YI( g)=>SH[g];}abstract class bB implements fD{var VH; initialize(); iC( g){} KD( g){} nB( g){} disabled( g){} enabled( g){}}class iB<QB>{var ZH;iB.BH(this.ZH); operator[]( g)=>ZH[g]; get size=>ZH.size; get isEmpty=>ZH.isEmpty; contains( g)=>ZH.contains(g); forEach( g( element))=>ZH.forEach(g);}class l{final  id;var wH=0;var yH=0;var YC=0;var VH;var rH;var vH;l.CH(this.VH,this.id){rH=VH.iF;vH=VH.DE;} OI( g){yH|= g;} SI( g){yH&= ~g;} VI( g){YC|= g;} WI( g){YC&= ~g;} toString()=>"Entity[${id}]"; xB( g){vH.DI(this,XC.ZC(g.runtimeType),g);} ZE( g){vH.QI(this,XC.ZC(g));} get NB=>rH.isActive(id); nC()=>VH.gF(this); MC()=>VH.aF(this);}abstract class TB extends cB{TB( g):super(g); SB( g); jB( h)=>h.forEach((g)=>SB(g)); OB()=>true;}abstract class aC extends cB{var hH=0;var lH=0;final  nH; get aB=>lH;aC(this.nH, g):super(g); OB(){hH+= m.aB;lH+= m.aB;if(hH>=nH){hH-= nH;return true;}return false;} end(){lH=0;}}class GB<cC extends v>{var iH;var mH;GB( h, g){this.iH=XC.ZC(h);mH=g.DE.lF(this.iH);}cC get( g)=>mH[g.id] as cC; NE( g){if(mH.uF(g.id)){return mH[g.id] as cC;}return null;}}class bC extends bB{var gH;var oH;bC(){gH=new Map<l,String>();oH=new Map<String,t<l>>();} IG( i, h){gH[i]=h;var g=oH[h];if(g==null){g=new t<l>();oH[h]=g;}g.add(i);} mF( h){var g=oH[h];if(g==null){g=new t<l>();}return g.readOnly;} DG( g){var h=gH[g];if(h!=null){var i=oH[h];if(i!=null){i.remove(g);}}} initialize(){} nB( g)=>DG(g);}class t<QB>{var eH;var fH=0;var jH;t({ capacity: 16}):eH=new List(capacity){jH=new iB.BH(this);} operator[]( g)=>eH[g]; get size=>fH; get readOnly=>jH; get isEmpty=>fH==0; forEach( h( element)){for(int g=0;g<fH;g++ ){h(eH[g]);}} removeAt( g){var h=eH[g];eH[g]=eH[ --fH];eH[fH]=null;return h;} removeLast(){if(fH>0){var g=eH[ --fH];eH[fH]=null;return g;}return null;} remove( i){for(int g=0;g<fH;g++ ){var h=eH[g];if(i==h){eH[g]=eH[ --fH];eH[fH]=null;return true;}}return false;} contains( h){for(int g=0;fH>g;g++ ){if(h==eH[g]){return true;}}return false;} get ZF=>eH.length; add( g){if(fH==eH.length){fI();}eH[fH++ ]=g;} operator[]=( g, h){if(g>=eH.length){gI(g*2);}if(fH<=g){fH=g+1;}eH[g]=h;} fI(){var g=((eH.length*3)/2+1).toInt();gI(g);} gI( h){var g=eH;eH=new List<QB>(h);eH.setRange(0,g.length,g);} JI( g){if(g>=eH.length){gI(g*2);}} clear(){for(int g=0;g<fH;g++ ){eH[g]=null;}fH=0;} addAll( h){for(int g=0;h.size>g;g++ ){add(h[g]);}} uF( g)=>g<ZF; toString()=>"[${eH.join(',')}]";}abstract class v{ sH(){}}class iD{static var BD=new Map<Type,t<lB>>();static lB vE( i, k){var h=xE(i);var g=h.removeLast();if(null==g){g=k();}return g;}static  xE( h){var g=BD[h];if(null==g){g=new t();BD[h]=g;}return g;}static  yE( g){BD[g.runtimeType].add(g);}}class jD extends bB{final  qH;final  uH;jD():qH=new Map<String,l>(),uH=new Map<l,String>(); register( g, h){qH[h]=g;uH[g]=h;} unregister( g){uH.remove(qH.remove(g));} LE( g)=>qH[g]; nB( h){var g=uH.remove(h);if(g!=null){qH.remove(g);}} initialize(){}}abstract class kD extends cB{kD():super(AB.HC()); jB( g)=>UD(); UD(); OB()=>true;}class GC{final  rH=new zC();final  vH=new yC();final  cH=new t<l>();final  BI=new t<l>();final  XH=new t<l>();final  II=new t<l>();final  KI=new t<l>();final  LI=new Map<Type,cB>();final  MI=new List<cB>();final  NI=new Map<Type,bB>();final  RI=new t<bB>();var aB=0;var TI=0;var UI=0.0; get PC=>TI; get time=>UI;GC(){hC(rH);hC(vH);} initialize(){RI.forEach((h)=>h.initialize());MI.forEach((g)=>g.initialize());} get iF=>rH; get DE=>vH; hC( g){NI[g.runtimeType]=g;RI.add(g);g.VH=this;} qC( g){return NI[g];} eF(){return rH.GI();} LE( g){return rH.YI(g);} HB( g,{ passive: false}){g.m=this;g.HI=passive;LI[g.runtimeType]=g;MI.add(g);return g;} BC( g){return LI[g];} ZI( i, h(EntityObserver,Entity)){i.forEach((g){RI.forEach((k)=>h(k,g));MI.forEach((o)=>h(o,g));});i.clear();} process(){TI++ ;UI+= aB;CG();MI.forEach((g){if(!g.yF){g.process();}});} CG(){ZI(cH,(h,g)=>h.iC(g));ZI(BI,(h,g)=>h.KD(g));ZI(KI,(h,g)=>h.disabled(g));ZI(II,(h,g)=>h.enabled(g));ZI(XH,(h,g)=>h.nB(g));vH.cF();} VF( g)=>cH.add(g); aF( g)=>BI.add(g); gF( g){if(!XH.contains(g)){XH.add(g);}}}class lD extends bB{}abstract class cB implements fD{var xH=0;var m;var zH;var AI;var CI;var EI;var FI;var HI;cB( g):zH=new t<l>(),AI=g.WF,CI=g.jF,EI=g.xF{FI=AI==0&&EI==0;xH=rE.tE(runtimeType);}get yF=>HI; JD(){} process(){if(OB()){JD();jB(zH.readOnly);end();}} end(){} jB( g); OB(); initialize(){} sF( g){} EG( g){} ZI( g){if(FI){return;}var i=aI(g);var h=(AI&g.yH)==AI;if(EI>0&&h){h=(EI&g.yH)>0;}if(CI>0&&h){h=(CI&g.yH)==0;}if(h&&!i){dI(g);}else if(!h&&i){eI(g);}} aI( g)=>(xH&g.YC)==xH; dI( g){zH.add(g);g.VI(xH);sF(g);} eI( g){zH.remove(g);g.WI(xH);EG(g);} iC( g)=>ZI(g); KD( g)=>ZI(g); enabled( g)=>ZI(g); nB( g){if(aI(g)){eI(g);}} disabled( g){if(aI(g)){eI(g);}}}class wE extends v with lB{ sH(){wF();} BE(){}}class AB{var AI=0;var CI=0;var EI=0; XF( g){AI=XI(AI,g);return this;} KE( g){CI=XI(CI,g);return this;}static  RB( h){var g=new AB();g.XF(h);return g;}static  HC()=>new AB(); get WF=>AI; get jF=>CI; get xF=>EI; XI( g, h){if(null!=h){h.forEach((i){g=g|XC.uE(i);});}return g;}}typedef  mD();abstract class lB{factory lB.DH( g, h){return iD.vE(g,h);} BE(); wF(){BE();iD.yE(this);}}class zE{var bI;var cI=0;zE():bI=new t<int>(); bF(){if(bI.size>0){return bI.removeLast();}return cI++ ;}} AF( g, i, h){var k=(g==0.0||g==1.0)?g:hB.pow(2.0,-10.0*g)*hB.sin((g-0.3/4.0)*(2.0*hB.PI)/0.3)+1;return k*i+h;}class DB extends wE{var TC;var VD;var GG;var hI=new EB.KH(); get angle=>VD.z;set angle( g)=>VD.z=g; get position{hI.x=TC.x;hI.y=TC.y;return hI;}set position( g){TC.x=g.x;TC.y=g.y;}DB.EH();static BF()=>new DB.EH();factory DB.FH( i, g, h){return new DB.GH(new JB(i,g,0.0),new JB(0.0,0.0,h));}factory DB.GH( k,[ h, i]){var g=new lB.DH(DB,BF) as DB;g.TC=k;g.VD=(h==null)?new JB(0.0,0.0,0.0):h;g.GG=(i==null)?new JB(1.0,1.0,1.0):i;return g;}}LB(h, q,{ player, groups}){var g=h.eF();q.forEach((i)=>g.xB(i));if(groups!=null){var o=(h.qC(lD) as lD);groups.forEach((k)=>o.add(g,k));}if(player!=null){(h.qC(bC) as bC).IG(g,player);}h.VF(g);return g;}class fG extends kD{var canvas;var QD;var WE;var dE;var EC;var FB;fG(this.canvas); initialize(){WE=m.qC(bC);dE=m.qC(jD);EC=new GB<JC>(JC,m);FB=new GB<DB>(DB,m);canvas.onMouseMove.listen(pF);} UD(){if(null!=QD){var k=dE.LE(gC);var g=EC.get(k);var q=FB.get(k).position;var i=q.x-QD.x;if(i>5){g.angle=hB.PI/2;g.abs=0.25;}else if(i<-5){g.angle=-hB.PI/2;g.abs=0.25;}else{g.angle=0.0;g.abs=0.0;}WE.mF(gC).forEach((o){var h=EC.NE(o);if(null!=h){h.abs=g.abs;h.angle=g.angle;}});}} pF( g){QD=VC.eD(g);}}class eG extends TB{var FB;var yB;var context;var sheet;eG(this.context,this.sheet):super(AB.RB([DB,vB])); initialize(){FB=new GB<DB>(DB,m);yB=new GB<vB>(vB,m);} SB( h){var u=FB.get(h);var k=yB.get(h);var o=u.position;var q='${k.LC}.png';var i=sheet.MD(q);var g=i.pB['${k.LC}.png'];context.drawImageToRect(i.ND,new gB.Rect(o.x+g.OC.left,o.y+g.OC.top,g.OC.width,g.OC.height),sourceRect:g.src);}}class nD extends TB{var aE;var VB;var NB=false;nD(this.VB):super(AB.RB([GD]));initialize(){aE=new GB<GD>(GD,m);}SB( g){if(NB){var h=aE.get(g);VB.VE('default',h.CE);}g.nC();} ZB(){NB=true;}} CF(){return gB.HttpRequest.getString('../assets/achievements.json').then(CD);}typedef  DF();typedef  EF( version);class gG extends aC{var kF=0;var oF=0;var DC;var PB=new List<sB>();var sheet;var yD;var PE;var VB;gG(this.yD,this.PE,this.sheet,this.VB):super(10000,AB.HC()); initialize(){PB.add(iI);PB.add(jI);PB.add(jI);PB.add(kI);PB.add(lI);PB.add(mI);DC=BB.nextInt(PB.length);PB[DC].SD=PB[DC].TD();} jB( k){var g=PB.removeAt(DC);var i='${ ++kF*10} seconds played!';g.ZB(g.SD);LB(m,[new HD(g.zD,i),new uB(8000.0)]);if(PB.length>0){DC=BB.nextInt(PB.length);var h=PB[DC];h.SD=h.TD();}} OB()=>super.OB()&&PB.length>0; get iI{var h=yD;var g=(nI)=>(m.BC(eC) as eC).ZB();return new sB('achievements',h,g);} get jI{var g=()=>PE( ++oF);return new sB('graphics1',g,sI);} get kI{return new sB('sound',tI,uI);} get mI{return new sB('planes',vI,wI);} get lI{return new sB('tanks',vI,xI);} vI(){} sI( h){h.then((g){sheet.add(g);(m.BC(pD) as pD).YE(1);});} tI(){var k=new gB.AudioElement();var g='ogg';var o=['probably','maybe'];if(o.contains(k.canPlayType('audio/ogg'))){g='ogg';}else if(o.contains(k.canPlayType('audio/mpeg; codecs="mp3"'))){g='mp3';}else if(o.contains(k.canPlayType('audio/mp3'))){g='mp3';}var h=new List<IB.Future>();for(int i=0;i<FD;i++ ){h.add(VB.sC('explosion_${i}','explosion_${i}.${g}').load());}h.add(VB.sC('shoot_0','shoot_0.${g}').load());h.add(VB.sC('collision_0','collision_0.${g}').load());return IB.Future.wait(h);} uI( h){h.then((nI){var g=m.BC(nD);g.ZB();});} wI(nI){var g=m.BC(uD);g.ZB();} xI(nI){var g=m.BC(vD);g.ZB();}} FF( g){return gB.HttpRequest.getString('${g}.polygons.json').then(CD).then(GF);} GF( q){var g=new Map<String,List<tB>>();q.forEach((k,o){var h=new List<tB>();o.forEach((i)=>h.add(new tB(i['shape'])));g[k]=h;});return new IB.Future.value(g);} HF(){var k=gB.window.location.href.lastIndexOf('/web/');var h=gB.window.location.href.substring(0,k)+'/assets/sfx/';var g;try {if(null==new FC.AudioContext().createBufferSource().gain)throw 'this ain\'t no real AudioContext';g=new fB(h);var i=g.vF('default');i.XE=false;}catch (o){g=new hG(h);}return g;} oD( g){return gB.HttpRequest.getString('${g}.json').then(CD).then((h)=>IF(g,h));} IF( q, u){var h=new IB.Completer<XB>();var g=new gB.ImageElement();g.onLoad.listen((nI){var i=new Map<String,KF>();u['frames'].forEach((o,KB){i[o]=new KF(KB);});var k=new XB(g,i);h.complete(k);});g.src='${q}.png';return h.future;}class hG implements fB{var baseURL;hG([this.baseURL='/']);var oI=new Map<String,JF>(); sC( h, i){var g=oI[h];if(g!=null){return g;}g=new JF.HH(this,h,"${baseURL}${i}");oI[h]=g;return g;} VE( h, g,[ i=false]){oI[g].play();return null;} noSuchMethod( g){}}class dC{var wC;dC( g){wC=new List<XB>();wC.add(g);} add( g)=>wC.insert(0,g); MD( g)=>wC.where((h)=>h.pB.containsKey(g)).first;}class XB{final  ND;final  pB;XB(this.ND,this.pB);}class pD extends kD{var kC;var context;var sheet;pD(this.context,this.sheet); initialize(){kC=new gB.CanvasElement(width:dB,height:eB);YE(16);} JD(){context.save();} UD(){context.drawImage(kC,0,(m.time/20)%eB);context.drawImage(kC,0,(m.time/20)%eB-eB+1);} end(){context.restore();} YE( u){var q=kC.context2D;q.clearRect(0,0,dB,eB);var g=sheet.MD('bg_rect_0.png');var h=g.pB['bg_rect_0.png'].src.width;var k=g.pB['bg_rect_0.png'].src.height;for(int o=0;o<eB/k;o++ ){for(int i=0;i<dB/h;i++ ){q.drawImageToRect(g.ND,new gB.Rect(i*h,o*k,h,k),sourceRect:g.pB['bg_rect_${BB.nextInt(u)}.png'].src);}}}}class JF implements MB{final  pI;var qI;var rI;var jC=new List<gB.AudioElement>();JF.HH(this.pI,this.qI,this.rI); load(){var g=new gB.AudioElement();var h=new IB.Completer<MB>();g.onCanPlay.first.then((nI){h.complete(this);});g.src=rI;jC.add(g);return h.future;} play(){var h=jC.where((i)=>i.ended).iterator;var g;if(h.moveNext()){g=h.current;}else{g=jC[0].clone(false);jC.add(g);}g.play();} noSuchMethod( g){}}class KF{var src;var OC;var offset;KF( o){var g=new LF(o);var h=g.PC;var i,k;if(g.gE){i=-(g.XD.w~/2-g.YD.x);k=-(g.XD.oB~/2-g.YD.y);}else{i=-g.PC.w~/2;k=-g.PC.oB~/2;}src=new gB.Rect(h.x,h.y,h.w,h.oB);OC=new gB.Rect(i,k,h.w,h.oB);offset=new EB(i.toDouble(),k.toDouble());}}class LF{var PC;var gE;var YD;var XD;LF( g):PC=new qD(g["frame"]),gE=g["trimmed"],YD=new qD(g["spriteSourceSize"]),XD=new MF(g["sourceSize"]);}class qD{var x,y,w,oB;qD( g):x=g["x"].toInt(),y=g["y"].toInt(),w=g["w"].toInt(),oB=g["h"].toInt();}class eC extends TB{var AE;var em;var context;var ID;var yI;var NB=false;eC(this.context):super(AB.RB([HD,uB])); initialize(){AE=new GB<HD>(HD,m);em=new GB<uB>(uB,m);yI=mE(200,200);yI.context2d..textBaseline='top'..font='16px Verdana'..fillStyle='#d3d1cc'..lineWidth=5;} JD(){yI.clear();} SB( o){var h=AE.get(o);var g=em.get(o);var k=yI.eE(h.RD,180);var u=yI.eE(ID[h.id],180);var i=20+k.height+u.height;var q=hB.max(1.0,4*g.time/g.tC);yI.context2d.globalAlpha=q;yI.FG(5,5,190,i,15,strokeStyle:'#d3d1cc',fillStyle:'#ffffff');yI.iE(h.RD,10,10,200);yI.iE(ID[h.id],10,k.height+10,200);context.drawImage(yI.canvas,5,AF(g.time/g.tC,i,-i));}ZB(){NB=true;} OB()=>NB;}class MF{var w,oB;MF( g):w=g["w"].toInt(),oB=g["h"].toInt();} CD( g){return new IB.Future.value(SG.parse(g));}class sB{var zD;var SD;var TD;var ZB;sB(this.zD,this.TD,this.ZB);}class kG extends TB{var OE;var FB;kG():super(AB.RB([DD,DB]).KE([IC])); initialize(){OE=new GB<DD>(DD,m);FB=new GB<DB>(DB,m);} SB( g){var h=OE.get(g);var i=FB.get(g).position;g.xB(new IC(h.EE));g.MC();LB(m,[new DB.FH(i.x,i.y,0.0),new JC(0.3,0.0),new vB('bullet_${BB.nextInt(4)}'),new uB(2000.0),new PF(),new OF(),new rD(h.GE)]);LB(m,[new GD('shoot_0')]);}}class DD extends v{var EE;var GE;DD(this.GE,this.EE);}class iG extends TB{var cm;iG():super(AB.RB([IC])); initialize(){cm=new GB<IC>(IC,m);} SB( g){var h=cm.get(g);h.value-= m.aB;if(h.value<0.0){g.ZE(IC);g.MC();}}}class jG extends cB{var FB;var yB;var IE;var mB;jG(this.mB):super(AB.RB([DB,vB]).KE([NF])); initialize(){FB=new GB<DB>(DB,m);yB=new GB<vB>(vB,m);IE=new GB<rD>(rD,m);} jB( i){var WB=i.size;if(WB>1){for(int k=0;k<i.size-1;k++ ){for(int o=k+1;o<i.size;o++ ){var g=i[k];var h=i[o];var UC=FB.get(g).position;var KB=FB.get(h).position;var cD=yB.get(g).LC;var q=yB.get(h).LC;var u=mB[cD];var UB=mB[q];if(hF(u,UC,UB,KB)){g.xB(new sD());h.xB(new sD());fE(g,h);fE(h,g);g.MC();h.MC();}}}}} fE(h,i){var g=IE.NE(h);if(null!=g){i.xB(new fC(g.value));}} hF( cD, q, NG, OG){var g=true;NG.forEach((PG){g=false;cD.where((zI)=>!g).forEach((WB){g=true;var UC=WB.kB.last;WB.kB.forEach((UB){var u=nF(UC+q,UB+q);var k=(UB+q).pC(u);var KB=k;WB.kB.sublist(1).forEach((QG){var h=(QG+q).pC(u);k=hB.min(k,h);KB=hB.max(KB,h);});var i;var o;var yG=true;PG.kB.forEach((RG){var h=(RG+OG).pC(u);if(null==i){i=h;o=h;}i=hB.min(i,h);o=hB.max(o,h);});if(KB<i||k>o){g=false;return;}UC=UB;});if(g){return;}});if(g){return;}});return g;} nF( h, i){var g=new EB(-h.y+i.y,h.x-i.x);g.normalize();return g;} OB()=>true;}class tB{var kB;tB( h){kB=new List(h.length~/2);for(int g=0;g<h.length;g+= 2){kB[g~/2]=new EB(h[g].toDouble(),h[g+1].toDouble());}}}class IC extends v{var value;IC(this.value);}class JC extends v{var abs,angle;JC(this.abs,this.angle);}class uB extends v{var time,tC;uB(this.tC){time=tC;}}class vB extends v{var LC;vB(this.LC);}class lG extends TB{var em;lG():super(AB.RB([uB])); initialize(){em=new GB<uB>(uB,m);} SB( h){var g=em.get(h);g.time-= m.aB;if(g.time<0.0){h.nC();}}}class fC extends v{var value;fC(this.value);}class rD extends v{var value;rD(this.value);}const dB=600;const eB=720;class ED extends v{var TE,LD;ED(this.TE){LD=TE;}}const gC='player1';const FD=4;var BB=new hB.Random();class GD extends v{final  CE;GD(this.CE);}class HD extends v{var id;var RD;HD(this.id,this.RD);}class mG extends TB{var FB;var EC;mG():super(AB.RB([DB,JC])); initialize(){FB=new GB<DB>(DB,m);EC=new GB<JC>(JC,m);} SB( i){var k=FB.get(i);var h=EC.get(i);var g=k.position;g.x=g.x-h.abs*hB.sin(h.angle)*m.aB;g.y=g.y-h.abs*hB.cos(h.angle)*m.aB;k.position=g;}}class nG extends TB{var FB;nG():super(AB.RB([sD,OF,DB])); initialize(){FB=new GB<DB>(DB,m);} SB( h){var g=FB.get(h).position;LB(m,[new DB.FH(g.x,g.y,0.0),new vB('impact_${BB.nextInt(8)}'),new NF(),new uB(50+BB.nextDouble()*100)]);LB(m,[new DB.FH(g.x,g.y,0.0),new vB('impact_${BB.nextInt(8)}'),new NF(),new uB(50+BB.nextDouble()*100)]);LB(m,[new DB.FH(g.x,g.y,0.0),new vB('impact_${BB.nextInt(8)}'),new NF(),new uB(50+BB.nextDouble()*100)]);LB(m,[new GD('collision_0')]);}}class NF extends v{}class sD extends v{}class tD extends v{}class OF extends v{}class PF extends v{}class QF extends v{}class oG extends TB{var QE;var HE;oG():super(AB.RB([ED,fC])); initialize(){QE=new GB<ED>(ED,m);HE=new GB<fC>(fC,m);} SB( g){var h=QE.get(g);var i=HE.get(g);h.LD-= i.value;g.ZE(fC);if(h.LD<=0){g.xB(new tD());}g.MC();}}class pG extends TB{var FB;pG():super(AB.RB([tD,QF,DB])); initialize(){FB=new GB<DB>(DB,m);} SB( h){var g=FB.get(h).position;LB(m,[new DB.FH(g.x,g.y,0.0),new vB('explosion_${BB.nextInt(8)}'),new NF(),new uB(50+BB.nextDouble()*100)]);LB(m,[new DB.FH(g.x,g.y,0.0),new vB('explosion_${BB.nextInt(8)}'),new NF(),new uB(50+BB.nextDouble()*100)]);LB(m,[new DB.FH(g.x,g.y,0.0),new vB('explosion_${BB.nextInt(8)}'),new NF(),new uB(50+BB.nextDouble()*100)]);LB(m,[new GD('explosion_${BB.nextInt(FD)}')]);LB(m,[new GD('explosion_${BB.nextInt(FD)}')]);}}class qG extends TB{qG():super(AB.RB([tD])); SB( g)=>g.nC();}class rG extends aC{var NB=true;rG():super(5000,AB.HC()); jB(zI){LB(m,[new DB.FH(BB.nextDouble()*dB,-20.0,hB.PI),new JC(0.05+BB.nextDouble()*0.025,-hB.PI),new vB('truck_0'),new ED(2),new QF(),new uB(15000.0)]);} OB()=>NB&&super.OB();}class sG extends TB{sG():super(AB.RB([sD,PF])); SB( g){g.nC();}}class uD extends aC{var NB=false;uD():super(6000,AB.HC()); jB(zI){LB(m,[new DB.FH(BB.nextDouble()*dB,-20.0,hB.PI),new JC(0.1+BB.nextDouble()*0.05,-hB.PI),new vB('plane_${BB.nextInt(2)}'),new ED(3),new QF(),new uB(15000.0)]);} ZB(){NB=true;} OB()=>NB&&super.OB();}class vD extends aC{var NB=false;vD():super(7000,AB.HC()); jB(zI){LB(m,[new DB.FH(BB.nextDouble()*dB,-20.0,hB.PI),new JC(0.06+BB.nextDouble()*0.04,-hB.PI),new vB('tank_${BB.nextInt(2)}'),new ED(5),new QF(),new uB(15000.0)]);} ZB(){NB=true;} OB()=>NB&&super.OB();}class RF{final  AJ;var BJ;var CJ;var DJ;RF.IH(this.AJ, g){BJ=new wB.IH(AJ,'music',g);BJ.XE=false;} UJ(){if(CJ!=null){CJ.stop();CJ=null;}} get pause=>CJ==null?false:CJ.pause; set pause( g){if(CJ!=null){CJ.pause=g;}} play({loop: true}){UJ();CJ=new YB.IH(BJ,DJ,loop);CJ.play();} stop(){UJ();}}class wD{var bD=0;var KC=0.0;var qB=0.0;var cE=0.0;var NC=0.0;var ZD=0.3;var uC=0.0;var xC=0.0;var oC=0.0;var hE=0.0;var aD=0.0;var zB=0.0;var mC=0.0;var bE=0.0;var JE=0.0;var vC=0.0;var RC=0.0;var SC=0.0;var CC=0.0;var SE=0.0;var PD=0.0;var rC=0.0;var RE=0.0;var QC=0.0;wD.JH( k){var g=k.split(",");this.bD=SF(g[0]);this.KC=CB(g[1]);this.qB=CB(g[2]);this.cE=CB(g[3]);this.NC=CB(g[4]);this.ZD=CB(g[5]);this.uC=CB(g[6]);this.xC=CB(g[7]);this.oC=CB(g[8]);this.hE=CB(g[9]);this.aD=CB(g[10]);this.zB=CB(g[11]);this.mC=CB(g[12]);this.bE=CB(g[13]);this.JE=CB(g[14]);this.vC=CB(g[15]);this.RC=CB(g[16]);this.SC=CB(g[17]);this.CC=CB(g[18]);this.SE=CB(g[19]);this.PD=CB(g[20]);this.rC=CB(g[21]);this.RE=CB(g[22]);this.QC=CB(g[23]);if(this.qB<.01){this.qB=.01;}var i=this.KC+this.qB+this.NC;if(i<.18){var h=.18/i;this.KC*= h;this.qB*= h;this.NC*= h;}}static  SF( g){if(g==null||g.length==0){return 0;}return int.parse(g,radix:10);}static  CB( g){if(g==null||g.length==0){return 0.0;}return double.parse(g);}}class MB{static const xD="sfxr:";final  AJ;var EJ;var FJ; get url=>FJ;var GJ;var HJ=false;var IJ='';var KJ=false;var NJ=false;MB.IH(this.AJ,this.EJ,this.FJ); ZJ(){KJ=false;GJ=null;} dF(){HJ=false;IJ='OK';} pJ( g){HJ=true;IJ=g;} qJ( g, h){if(g==null){pJ('Error decoding buffer.');h.complete(this);return;}dF();GJ=g;KJ=true;h.complete(this);} rJ( h, g){var i=h.response;AJ.QJ.decodeAudioData(i).then((k){qJ(k,g);}).catchError((o){qJ(null,g);});} sJ( h, g){pJ('Error fetching data');g.complete(this);} load(){if(url==null){pJ('No URL set.');return new IB.Future<MB>.value(this);}ZJ();if(url.startsWith(xD)){return new IB.Future<MB>.delayed(new Duration(milliseconds:1),(){GJ=TF.UF(AJ.QJ,url.substring(xD.length));KJ=true;return this;});}var g=new gB.HttpRequest();var h=new IB.Completer<MB>();if(NJ){g.open('GET',url);}else{g.open('GET','${AJ.baseURL}/${url}');}g.responseType='arraybuffer';g.onLoad.listen((i)=>rJ(g,h));g.onError.listen((i)=>sJ(g,h));g.onAbort.listen((i)=>sJ(g,h));g.send();return h.future;} get length{if(GJ==null){return 0;}return GJ.duration;}}class YB{final  BJ;final  DJ;final  JJ;var LJ;var MJ;var OJ;var PJ; get RJ=>LJ.gain.value; get isScheduled=>LJ==null?false:LJ.playbackState==FC.AudioBufferSourceNode.SCHEDULED_STATE; get tF=>LJ==null?false:LJ.playbackState==FC.AudioBufferSourceNode.FINISHED_STATE;YB.IH(this.BJ,this.DJ,this.JJ){nJ();} oJ(){if(LJ!=null){print('${LJ.playbackState}');}} nJ(){LJ=BJ.AJ.QJ.createBufferSource();if(DJ!=null&&DJ.GJ!=null){LJ.buffer=DJ.GJ;LJ.loopStart=0.0;LJ.loopEnd=DJ.GJ.duration;}LJ.gain.value=RJ;LJ.loop=JJ;LJ.connectNode(BJ.YJ,0,0);} UJ([ g=0.0]){if(LJ!=null){LJ.stop(g);}LJ=null;} get pause=>MJ!=null; set pause( g){if(g){if(MJ!=null){return;}tJ();}else{if(MJ==null){return;}uJ();}} get time{var g=BJ.AJ.QJ.currentTime;if(MJ!=null){return MJ;}return vJ();} vJ(){assert(OJ!=null);var g=BJ.AJ.QJ.currentTime;var h=g-OJ;if(g<PJ){return g-PJ;}if(JJ){return h%LJ.buffer.duration;}return h;} tJ([ g=0.0]){if(OJ==null){return;}print('Sound.pause');oJ();if(LJ!=null){MJ=vJ();UJ(g);print('paused at ${MJ}');}} uJ(){if(MJ==null){return;}print('Sound.resume');oJ();nJ();if(MJ<0.0){MJ=-MJ;print('Scheduling to play sound in ${MJ}.');PJ=BJ.AJ.QJ.currentTime+MJ;LJ.start(PJ,0.0,LJ.buffer.duration);OJ=BJ.AJ.QJ.currentTime;}else{print('Starting to play at offset ${MJ}');PJ=BJ.AJ.QJ.currentTime;LJ.start(PJ,MJ,LJ.buffer.duration-MJ);OJ=BJ.AJ.QJ.currentTime-MJ;}MJ=null;} play([ g=0.0]){UJ();nJ();PJ=BJ.AJ.QJ.currentTime+g;LJ.start(PJ);OJ=BJ.AJ.QJ.currentTime;} stop(){UJ();OJ=null;PJ=null;MJ=null;} get volume=>RJ; set volume( g){if(LJ!=null){LJ.gain.value=g;}}}class fB{var QJ;var SJ;var TJ;var VJ;var XJ;var aJ;var baseURL;var eJ=new Map<String,MB>();var iJ=new Map<String,wB>();var mJ;fB([this.baseURL='']){QJ=new FC.AudioContext();SJ=QJ.destination;TJ=QJ.listener;VJ=QJ.createGain();XJ=QJ.createGain();aJ=QJ.createGain();VJ.connectNode(SJ,0,0);XJ.connectNode(VJ,0,0);aJ.connectNode(VJ,0,0);mJ=new RF.IH(this,XJ);} get QC=>VJ.gain.value; set QC( g){UE=false;VJ.gain.value=g;}var dJ; set UE( g){if(g){if(dJ!=null){return;}dJ=VJ.gain.value;VJ.gain.value=0;}else{if(dJ==null){return;}VJ.gain.value=dJ;dJ=null;}}var xJ=false;var yJ=false; sC( h, i){var g=eJ[h];if(g!=null){return g;}g=new MB.IH(this,h,i);eJ[h]=g;return g;} vF( h){var g=iJ[h];if(g!=null){return g;}g=new wB.IH(this,h,aJ);iJ[h]=g;return g;} VE( g, h,[ i=false]){return zF(0.0,g,h,i);} zF( k, i, o,[ q=false]){var g=iJ[i];if(g==null){print('Could not find source ${i}');return null;}var h=eJ[o];if(h==null){print('Could not find clip ${o}');return null;}if(q){return g.AG(k,h);}else{return g.BG(k,h);}}}class wB{var AJ;var EJ;var WJ;var YJ;var bJ;var cJ;var dJ;var fJ=false;var gJ=0.0;var hJ=0.0;var jJ=0.0;var kJ=true; lJ(){bJ.disconnect(0);YJ.disconnect(0);if(kJ){YJ.connectNode(bJ,0,0);bJ.connectNode(WJ,0,0);}else{YJ.connectNode(WJ,0,0);}}wB.IH(this.AJ,this.EJ,this.WJ){YJ=AJ.QJ.createGain();bJ=AJ.QJ.createPanner();bJ.coneOuterGain=1.0;lJ();cJ=new List<YB>();} set XE( g){if(g!=kJ){kJ=g;lJ();}} get volume=>YJ.gain.value; set volume( g){YJ.gain.value=g;} set UE( g){if(g){if(dJ!=null){return;}dJ=volume;volume=0.0;}else{if(dJ==null){return;}volume=dJ;dJ=null;}} BG( i, h){var g=new YB.IH(this,h,false);cJ.add(g);g.play(i);g.pause=pause;return g;} AG( i, h){var g=new YB.IH(this,h,true);cJ.add(g);g.play(i);g.pause=pause;return g;} wJ(){for(int g=cJ.length-1;g>=0;g-- ){var h=cJ[g];if(h.tF){var i=cJ.length-1;cJ[g]=cJ[i];cJ.removeLast();print('removing sound.');h.stop();}}} get pause=>fJ; set pause( g){if(g){if(fJ==true){return;}tJ();fJ=true;}else{if(fJ==false){return;}uJ();fJ=false;}} tJ(){wJ();cJ.forEach((g){g.pause=true;});} uJ(){wJ();cJ.forEach((g){g.pause=false;});} stop(){cJ.forEach((g){g.stop();});wJ();} get x=>gJ; get y=>hJ; get z=>jJ;}class TF{final  zJ;var AK,BK,CK,DK,EK,FK,GK,HK,IK,JK;var KK,LK;TF( this.zJ); reset(){var g=this.zJ;DK=100/(g.ZD*g.ZD+.001);EK=100/(g.uC*g.uC+.001);FK=1-g.xC*g.xC*g.xC*.01;GK=-g.oC*g.oC*g.oC*.000001;if(g.bD==0){IK=.5-g.bE/2;JK=-g.JE*.00005;}HK=g.zB>0?1-g.zB*g.zB*.9:1+g.zB*g.zB*10;KK=0;LK=(g.mC==1?0:(1-g.mC)*(1-g.mC)*20000+32).toInt();} MG(){this.reset();var g=this.zJ;AK=g.KC*g.KC*100000;BK=g.qB*g.qB*100000;CK=g.NC*g.NC*100000+10;return (AK+BK+CK).toInt();} KG( q, u){var g=this.zJ;var MK=g.CC!=1||g.rC!=0,NK=g.rC*g.rC*.1,OK=1+g.RE*.0003,PK=g.CC*g.CC*g.CC*.1,QK=1+g.SE*.0001,RK=g.CC!=1,SK=g.QC*g.QC,TK=g.uC,UK=g.RC!=0||g.SC!=0,VK=g.SC*g.SC*g.SC*.2,WK=g.RC*g.RC*(g.RC<0?-1020:1020),XK=(g.vC!=0)?(((1-g.vC)*(1-g.vC)*20000).toInt())+32:0,YK=g.cE,ZK=g.hE/2,aK=g.aD*g.aD*.01,bK=g.bD;var cK=AK,dK=1/AK,eK=1/BK,fK=1/CK;var gK=5/(1+g.PD*g.PD*20)*(.01+PK);if(gK>.8){gK=.8;}gK=1-gK;var hK=false;var iK=0.0,jK=0.0,kK=0.0,lK=0.0,mK=0.0,nK=0.0,oK=0.0,pK=0.0,qK=0.0,rK=0.0,sK=0.0;var tK=0,uK=0,vK=0,wK=0,xK=0,yK=0;var o=new hB.Random();var zK=new List<double>(1024),AL=new List<double>(32);for(var h=zK.length-1;h>-1;h-- ){zK[h]=0.0;}for(var h=AL.length-1;h>-1;h-- ){AL[h]=o.nextDouble()*2-1;}for(var h=0;h<u;h++ ){if(hK){return true;}if(XK!=0){if( ++yK>=XK){yK=0;this.reset();}}if(LK!=0){if( ++KK>=LK){LK=0;DK*= HK;}}FK+= GK;DK*= FK;if(DK>EK){DK=EK;if(TK>0){hK=true;}}rK=DK;if(ZK>0){sK+= aK;rK*= 1+hB.sin(sK)*ZK;}tK=rK.toInt();if(tK<8){tK=8;}if(bK==0){IK+= JK;if(IK<0){IK=0.0;}else if(IK>.5){IK=.5;}}if( ++iK>cK){iK=0.0;switch ( ++vK){case 1:cK=BK;break;case 2:cK=CK;break;}}switch (vK){case 0:jK=iK*dK;break;case 1:jK=1+(1-iK*eK)*2*YK;break;case 2:jK=1-iK*fK;break;case 3:jK=0.0;hK=true;break;}if(UK){WK+= VK;xK=WK.toInt();if(xK<0){xK=-xK;}else if(xK>1023){xK=1023;}}if(MK&&OK!=0.0){NK*= OK;if(NK<.00001){NK=.00001;}else if(NK>.1){NK=.1;}}qK=0.0;for(var k=0;k<8;k++ ){uK++ ;if(uK>=tK){uK%= tK;if(bK==3){for(var i=AL.length-1;i>-1;i-- ){AL[i]=o.nextDouble()*2-1;}}}switch (bK){case 0:pK=((uK/tK)<IK)?.5:-.5;break;case 1:pK=1-(uK/tK)*2;break;case 2:oK=uK/tK;oK=oK>.5?(oK-1)*6.28318531:oK*6.28318531;pK=oK<0?1.27323954*oK+.405284735*oK*oK:1.27323954*oK-.405284735*oK*oK;pK=pK<0?.225*(pK*-pK-pK)+pK:.225*(pK*pK-pK)+pK;break;case 3:pK=AL[(uK*32/tK).abs().toInt()];break;}if(MK){mK=nK;PK*= QK;if(PK<0){PK=0;}else if(PK>.1){PK=.1;}if(RK){lK+= (pK-nK)*PK;lK*= gK;}else{nK=pK;lK=0.0;}nK+= lK;kK+= nK-mK;kK*= 1-NK;pK=kK;}if(UK){zK[wK%1024]=pK;pK+= zK[(wK-xK+1024)%1024];wK++ ;}qK+= pK;}qK*= .125*jK*SK;qK=qK>=1?1.0:qK<=-1?-1.0:qK;q[h]=qK;}return false;}static  UF( k, o){var i=new TF(new wD.JH(o));var h=i.MG();var g=k.createBuffer(2,h,44100);assert(h<=g.length);i.KG(g.getChannelData(0),h);return g;}}class JB{final  j=new dD.Float32List(3);JB( i, h, g){WD(i,h,g);} WD( i, h, g){j[0]=i;j[1]=h;j[2]=g;return this;} toString()=>'[${j[0]},${j[1]},${j[2]}]'; operator-()=>new JB(-j[0],-j[1],-j[2]); operator-( g)=>new JB(j[0]-g.j[0],j[1]-g.j[1],j[2]-g.j[2]); operator+( g)=>new JB(j[0]+g.j[0],j[1]+g.j[1],j[2]+g.j[2]); operator/( h){var g=1.0/h;return new JB(j[0]*g,j[1]*g,j[2]*g);} operator*( h){var g=h;return new JB(j[0]*g,j[1]*g,j[2]*g);} operator[]( g)=>j[g]; operator[]=( h, g){j[h]=g;} get length{var g;g=(j[0]*j[0]);g+= (j[1]*j[1]);g+= (j[2]*j[2]);return hB.sqrt(g);} normalize(){var g=length;if(g==0.0){return this;}g=1.0/g;j[0]*=g;j[1]*=g;j[2]*=g;return this;} pC( h){var g;g=j[0]*h.j[0];g+= j[1]*h.j[1];g+= j[2]*h.j[2];return g;} get isNaN{var g=false;g=g||j[0].isNaN;g=g||j[1].isNaN;g=g||j[2].isNaN;return g;} add( g){j[0]=j[0]+g.j[0];j[1]=j[1]+g.j[1];j[2]=j[2]+g.j[2];return this;}set r( g)=>j[0]=g;set AC( g)=>j[1]=g;set b( g)=>j[2]=g;set x( g)=>j[0]=g;set y( g)=>j[1]=g;set z( g)=>j[2]=g; get r=>j[0]; get AC=>j[1]; get b=>j[2]; get x=>j[0]; get y=>j[1]; get z=>j[2];}class EB{final  j=new dD.Float32List(2);EB( h, g){WD(h,g);}EB.KH(); WD( h, g){j[0]=h;j[1]=g;return this;} toString()=>'[${j[0]},${j[1]}]'; operator-()=>new EB(-j[0],-j[1]); operator-( g)=>new EB(j[0]-g.j[0],j[1]-g.j[1]); operator+( g)=>new EB(j[0]+g.j[0],j[1]+g.j[1]); operator/( h){var g=1.0/h;return new EB(j[0]*g,j[1]*g);} operator*( h){var g=h;return new EB(j[0]*g,j[1]*g);} operator[]( g)=>j[g]; operator[]=( h, g){j[h]=g;} get length{var g;g=(j[0]*j[0]);g+= (j[1]*j[1]);return hB.sqrt(g);} normalize(){var g=length;if(g==0.0){return this;}g=1.0/g;j[0]*=g;j[1]*=g;return this;} pC( h){var g;g=j[0]*h.j[0];g+= j[1]*h.j[1];return g;} get isNaN{var g=false;g=g||j[0].isNaN;g=g||j[1].isNaN;return g;} add( g){j[0]=j[0]+g.j[0];j[1]=j[1]+g.j[1];return this;}set r( g)=>j[0]=g;set AC( g)=>j[1]=g;set x( g)=>j[0]=g;set y( g)=>j[1]=g; get r=>j[0]; get AC=>j[1]; get x=>j[0]; get y=>j[1];}